<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: ui/rtk-settings.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BluetoothConnection.html">BluetoothConnection</a></div><div class="sidebar-section-children"><a href="ConnectionHandler.html">ConnectionHandler</a></div><div class="sidebar-section-children"><a href="ConnectionManager.html">ConnectionManager</a></div><div class="sidebar-section-children"><a href="DeviceSettings.html">DeviceSettings</a></div><div class="sidebar-section-children"><a href="EventEmitter.html">EventEmitter</a></div><div class="sidebar-section-children"><a href="GnssModule.html">GnssModule</a></div><div class="sidebar-section-children"><a href="NmeaParser.html">NmeaParser</a></div><div class="sidebar-section-children"><a href="NtripClient.html">NtripClient</a></div><div class="sidebar-section-children"><a href="RtkSettings.html">RtkSettings</a></div><div class="sidebar-section-children"><a href="RtkStatus.html">RtkStatus</a></div><div class="sidebar-section-children"><a href="Settings.html">Settings</a></div><div class="sidebar-section-children"><a href="SettingsPage.html">SettingsPage</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">ui_rtk-settings.js</h1></header><article><pre class="prettyprint source lang-js"><code>/**
 * RTK Settings UI Component
 * 
 * This component provides a user interface for configuring NTRIP RTK correction settings
 * and managing connections to NTRIP casters.
 */
export class RtkSettings {
  /**
   * Create an RTK settings component
   * @param {Object} options - Configuration options
   * @param {EventEmitter} options.events - Event emitter for communication
   * @param {Settings} options.settings - Settings manager
   * @param {string} options.selector - CSS selector for the container element
   */
  constructor(options = {}) {
    this.events = options.events;
    this.settings = options.settings;
    this.isConnected = false;
    this.isConnecting = false;
    
    // Find container element if selector provided
    if (options.selector) {
      this.container = document.querySelector(options.selector);
    }
    
    // If no container, don't initialize UI
    if (!this.container) {
      console.warn('RtkSettings: No container element found. UI will not be initialized.');
      return;
    }
    
    // Cache frequently used elements
    this.elements = {};
    
    // Add CSS for proper styling
    this.addStyles();
    
    // Create UI elements
    this.initializeUI();
    
    // Set up event listeners
    this.setupEventListeners();
    
    // Listen for RTK events
    this.registerEventListeners();
    
    // Load saved configuration
    this.loadSavedConfig();
  }

  /**
   * Add required CSS styles to the document
   */
  addStyles() {
    // Check if styles already exist
    if (document.getElementById('rtk-settings-styles')) {
      return;
    }
    
    // Create style element
    const style = document.createElement('style');
    style.id = 'rtk-settings-styles';
    style.textContent = `
      .rtk-settings-container {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        margin: 0 auto;
        padding: 15px;
        background-color: #f7f7f7;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .rtk-settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .rtk-settings-title {
        font-size: 18px;
        font-weight: 500;
        margin: 0;
      }
      
      .rtk-settings-enable {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }
      
      .rtk-settings-form {
        display: grid;
        grid-gap: 10px;
      }
      
      .form-group {
        display: flex;
        flex-direction: column;
      }
      
      .form-group label {
        font-size: 14px;
        color: #555;
        margin-bottom: 5px;
      }
      
      .form-group input, .form-group select {
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }
      
      .form-group input:focus, .form-group select:focus {
        outline: none;
        border-color: #4285F4;
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.25);
      }
      
      .rtk-settings-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
      }
      
      .rtk-status-display {
        display: flex;
        align-items: center;
        margin-top: 15px;
        padding: 10px;
        background-color: #f0f0f0;
        border-radius: 4px;
      }
      
      .rtk-status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      
      .rtk-status-indicator.disconnected { background-color: #9e9e9e; }
      .rtk-status-indicator.connecting { background-color: #ff9800; }
      .rtk-status-indicator.connected { background-color: #4caf50; }
      .rtk-status-indicator.error { background-color: #f44336; }
      
      .rtk-button {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      
      .rtk-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .rtk-button.primary {
        background-color: #4285F4;
        color: white;
      }
      
      .rtk-button.secondary {
        background-color: #f1f1f1;
        color: #333;
      }
      
      .rtk-button.danger {
        background-color: #f44336;
        color: white;
      }
      
      .rtk-button.primary:hover { background-color: #3367d6; }
      .rtk-button.secondary:hover { background-color: #e0e0e0; }
      .rtk-button.danger:hover { background-color: #d32f2f; }
      
      .rtk-toggle {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
        margin-right: 8px;
      }
      
      .rtk-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .rtk-toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 20px;
      }
      
      .rtk-toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      .rtk-toggle input:checked + .rtk-toggle-slider {
        background-color: #4285F4;
      }
      
      .rtk-toggle input:focus + .rtk-toggle-slider {
        box-shadow: 0 0 1px #4285F4;
      }
      
      .rtk-toggle input:checked + .rtk-toggle-slider:before {
        transform: translateX(20px);
      }
      
      .rtk-correction-stats {
        margin-top: 10px;
        font-size: 12px;
        color: #666;
      }
      
      .rtk-correction-stats div {
        margin-bottom: 4px;
      }
      
      @media (min-width: 768px) {
        .rtk-settings-form {
          grid-template-columns: 1fr 1fr;
          grid-gap: 15px;
        }
      }
    `;
    
    // Add style to document
    document.head.appendChild(style);
  }

  /**
   * Initialize the UI elements
   */
  initializeUI() {
    if (!this.container) return;
    
    // Clear container
    this.container.innerHTML = '';
    
    // Create main container
    const settingsContainer = document.createElement('div');
    settingsContainer.className = 'rtk-settings-container';
    
    // Create header
    const header = document.createElement('div');
    header.className = 'rtk-settings-header';
    
    const title = document.createElement('h2');
    title.className = 'rtk-settings-title';
    title.textContent = 'RTK Correction Settings';
    
    header.appendChild(title);
    settingsContainer.appendChild(header);
    
    // Create enable toggle
    const enableContainer = document.createElement('div');
    enableContainer.className = 'rtk-settings-enable';
    
    const toggleLabel = document.createElement('label');
    toggleLabel.className = 'rtk-toggle';
    
    const toggleInput = document.createElement('input');
    toggleInput.type = 'checkbox';
    toggleInput.id = 'rtk-enable';
    
    const toggleSlider = document.createElement('span');
    toggleSlider.className = 'rtk-toggle-slider';
    
    toggleLabel.appendChild(toggleInput);
    toggleLabel.appendChild(toggleSlider);
    
    const toggleText = document.createElement('span');
    toggleText.textContent = 'Enable RTK Corrections';
    
    enableContainer.appendChild(toggleLabel);
    enableContainer.appendChild(toggleText);
    
    settingsContainer.appendChild(enableContainer);
    
    // Create form
    const form = document.createElement('form');
    form.className = 'rtk-settings-form';
    
    // Connection method
    const connectionMethodGroup = document.createElement('div');
    connectionMethodGroup.className = 'form-group';
    
    const connectionMethodLabel = document.createElement('label');
    connectionMethodLabel.htmlFor = 'rtk-connection-mode';
    connectionMethodLabel.textContent = 'Connection Method';
    
    const connectionMethodSelect = document.createElement('select');
    connectionMethodSelect.id = 'rtk-connection-mode';
    
    const autoOption = document.createElement('option');
    autoOption.value = 'auto';
    autoOption.textContent = 'Auto (WebSocket preferred)';
    
    const websocketOption = document.createElement('option');
    websocketOption.value = 'websocket';
    websocketOption.textContent = 'WebSocket';
    
    const directOption = document.createElement('option');
    directOption.value = 'direct';
    directOption.textContent = 'Direct';
    
    const proxyOption = document.createElement('option');
    proxyOption.value = 'proxy';
    proxyOption.textContent = 'HTTP Proxy';
    
    connectionMethodSelect.appendChild(autoOption);
    connectionMethodSelect.appendChild(websocketOption);
    connectionMethodSelect.appendChild(directOption);
    connectionMethodSelect.appendChild(proxyOption);
    
    connectionMethodGroup.appendChild(connectionMethodLabel);
    connectionMethodGroup.appendChild(connectionMethodSelect);
    
    form.appendChild(connectionMethodGroup);
    
    // Caster host
    const hostGroup = document.createElement('div');
    hostGroup.className = 'form-group';
    
    const hostLabel = document.createElement('label');
    hostLabel.htmlFor = 'rtk-caster-host';
    hostLabel.textContent = 'NTRIP Caster Host';
    
    const hostInput = document.createElement('input');
    hostInput.type = 'text';
    hostInput.id = 'rtk-caster-host';
    hostInput.placeholder = 'caster.example.com';
    
    hostGroup.appendChild(hostLabel);
    hostGroup.appendChild(hostInput);
    
    form.appendChild(hostGroup);
    
    // Caster port
    const portGroup = document.createElement('div');
    portGroup.className = 'form-group';
    
    const portLabel = document.createElement('label');
    portLabel.htmlFor = 'rtk-caster-port';
    portLabel.textContent = 'NTRIP Caster Port';
    
    const portInput = document.createElement('input');
    portInput.type = 'number';
    portInput.id = 'rtk-caster-port';
    portInput.value = 2101;
    
    portGroup.appendChild(portLabel);
    portGroup.appendChild(portInput);
    
    form.appendChild(portGroup);
    
    // Mountpoint
    const mountpointGroup = document.createElement('div');
    mountpointGroup.className = 'form-group';
    
    const mountpointLabel = document.createElement('label');
    mountpointLabel.htmlFor = 'rtk-mountpoint';
    mountpointLabel.textContent = 'Mountpoint';
    
    const mountpointInput = document.createElement('input');
    mountpointInput.type = 'text';
    mountpointInput.id = 'rtk-mountpoint';
    mountpointInput.placeholder = 'MOUNTPOINT';
    
    mountpointGroup.appendChild(mountpointLabel);
    mountpointGroup.appendChild(mountpointInput);
    
    form.appendChild(mountpointGroup);
    
    // Username
    const usernameGroup = document.createElement('div');
    usernameGroup.className = 'form-group';
    
    const usernameLabel = document.createElement('label');
    usernameLabel.htmlFor = 'rtk-username';
    usernameLabel.textContent = 'Username';
    
    const usernameInput = document.createElement('input');
    usernameInput.type = 'text';
    usernameInput.id = 'rtk-username';
    usernameInput.placeholder = 'username (optional)';
    
    usernameGroup.appendChild(usernameLabel);
    usernameGroup.appendChild(usernameInput);
    
    form.appendChild(usernameGroup);
    
    // Password
    const passwordGroup = document.createElement('div');
    passwordGroup.className = 'form-group';
    
    const passwordLabel = document.createElement('label');
    passwordLabel.htmlFor = 'rtk-password';
    passwordLabel.textContent = 'Password';
    
    const passwordInput = document.createElement('input');
    passwordInput.type = 'password';
    passwordInput.id = 'rtk-password';
    passwordInput.placeholder = 'password (optional)';
    
    passwordGroup.appendChild(passwordLabel);
    passwordGroup.appendChild(passwordInput);
    
    form.appendChild(passwordGroup);
    
    // Send GGA toggle
    const ggaGroup = document.createElement('div');
    ggaGroup.className = 'form-group';
    
    const ggaLabel = document.createElement('label');
    ggaLabel.htmlFor = 'rtk-send-gga';
    ggaLabel.className = 'rtk-toggle';
    
    const ggaInput = document.createElement('input');
    ggaInput.type = 'checkbox';
    ggaInput.id = 'rtk-send-gga';
    ggaInput.checked = true;
    
    const ggaSlider = document.createElement('span');
    ggaSlider.className = 'rtk-toggle-slider';
    
    ggaLabel.appendChild(ggaInput);
    ggaLabel.appendChild(ggaSlider);
    
    const ggaText = document.createElement('span');
    ggaText.textContent = 'Send position to caster (GGA)';
    
    ggaGroup.appendChild(ggaLabel);
    ggaGroup.appendChild(ggaText);
    
    form.appendChild(ggaGroup);
    
    // GGA update interval
    const ggaIntervalGroup = document.createElement('div');
    ggaIntervalGroup.className = 'form-group';
    
    const ggaIntervalLabel = document.createElement('label');
    ggaIntervalLabel.htmlFor = 'rtk-gga-interval';
    ggaIntervalLabel.textContent = 'GGA Update Interval (seconds)';
    
    const ggaIntervalInput = document.createElement('input');
    ggaIntervalInput.type = 'number';
    ggaIntervalInput.id = 'rtk-gga-interval';
    ggaIntervalInput.min = 1;
    ggaIntervalInput.max = 60;
    ggaIntervalInput.value = 10;
    
    ggaIntervalGroup.appendChild(ggaIntervalLabel);
    ggaIntervalGroup.appendChild(ggaIntervalInput);
    
    form.appendChild(ggaIntervalGroup);
    
    // Auto reconnect toggle
    const reconnectGroup = document.createElement('div');
    reconnectGroup.className = 'form-group';
    
    const reconnectLabel = document.createElement('label');
    reconnectLabel.htmlFor = 'rtk-auto-reconnect';
    reconnectLabel.className = 'rtk-toggle';
    
    const reconnectInput = document.createElement('input');
    reconnectInput.type = 'checkbox';
    reconnectInput.id = 'rtk-auto-reconnect';
    reconnectInput.checked = true;
    
    const reconnectSlider = document.createElement('span');
    reconnectSlider.className = 'rtk-toggle-slider';
    
    reconnectLabel.appendChild(reconnectInput);
    reconnectLabel.appendChild(reconnectSlider);
    
    const reconnectText = document.createElement('span');
    reconnectText.textContent = 'Auto reconnect on disconnect';
    
    reconnectGroup.appendChild(reconnectLabel);
    reconnectGroup.appendChild(reconnectText);
    
    form.appendChild(reconnectGroup);
    
    settingsContainer.appendChild(form);
    
    // Create status display
    const statusDisplay = document.createElement('div');
    statusDisplay.className = 'rtk-status-display';
    
    const statusIndicator = document.createElement('div');
    statusIndicator.className = 'rtk-status-indicator disconnected';
    
    const statusText = document.createElement('div');
    statusText.textContent = 'Not connected';
    
    statusDisplay.appendChild(statusIndicator);
    statusDisplay.appendChild(statusText);
    
    // Correction statistics
    const correctionStats = document.createElement('div');
    correctionStats.className = 'rtk-correction-stats';
    correctionStats.style.display = 'none';
    
    const messagesReceived = document.createElement('div');
    messagesReceived.textContent = 'Messages received: 0';
    
    const correctionAge = document.createElement('div');
    correctionAge.textContent = 'Correction age: N/A';
    
    const bytesReceived = document.createElement('div');
    bytesReceived.textContent = 'Bytes received: 0';
    
    correctionStats.appendChild(messagesReceived);
    correctionStats.appendChild(correctionAge);
    correctionStats.appendChild(bytesReceived);
    
    statusDisplay.appendChild(correctionStats);
    
    settingsContainer.appendChild(statusDisplay);
    
    // Create action buttons
    const actions = document.createElement('div');
    actions.className = 'rtk-settings-actions';
    
    const saveButton = document.createElement('button');
    saveButton.type = 'button';
    saveButton.className = 'rtk-button secondary';
    saveButton.textContent = 'Save Settings';
    
    const connectButton = document.createElement('button');
    connectButton.type = 'button';
    connectButton.className = 'rtk-button primary';
    connectButton.textContent = 'Connect';
    
    const disconnectButton = document.createElement('button');
    disconnectButton.type = 'button';
    disconnectButton.className = 'rtk-button danger';
    disconnectButton.textContent = 'Disconnect';
    disconnectButton.style.display = 'none';
    
    actions.appendChild(saveButton);
    actions.appendChild(connectButton);
    actions.appendChild(disconnectButton);
    
    settingsContainer.appendChild(actions);
    
    // Add to container
    this.container.appendChild(settingsContainer);
    
    // Store references to elements
    this.elements = {
      enableToggle: toggleInput,
      connectionMethod: connectionMethodSelect,
      casterHost: hostInput,
      casterPort: portInput,
      mountpoint: mountpointInput,
      username: usernameInput,
      password: passwordInput,
      sendGga: ggaInput,
      ggaInterval: ggaIntervalInput,
      autoReconnect: reconnectInput,
      saveButton,
      connectButton,
      disconnectButton,
      statusIndicator,
      statusText,
      correctionStats,
      messagesReceived,
      correctionAge,
      bytesReceived
    };
    
    // Disable form if RTK is disabled
    this.updateFormState();
  }

  /**
   * Set up UI event listeners
   */
  setupEventListeners() {
    if (!this.elements) {
      console.warn('RtkSettings: No UI elements found. Event listeners not set up.');
      return;
    }
    
    // Safely add event listener to an element if it exists
    const safeAddListener = (elementKey, eventType, handler) => {
      const element = this.elements[elementKey];
      if (element) {
        element.addEventListener(eventType, handler);
      } else {
        console.warn(`RtkSettings: Element ${elementKey} not found`);
      }
    };
    
    // Enable/disable toggle
    safeAddListener('enableToggle', 'change', () => {
      this.updateFormState();
    });
    
    // Connect button
    safeAddListener('connectButton', 'click', () => {
      this.connect();
    });
    
    // Disconnect button
    safeAddListener('disconnectButton', 'click', () => {
      this.disconnect();
    });
    
    // Save settings button
    safeAddListener('saveButton', 'click', () => {
      this.saveConfig();
    });
  }

  /**
   * Register event listeners for GNSS events
   */
  registerEventListeners() {
    if (!this.events) {
      console.warn('RtkSettings: No events emitter provided. Settings will not update.');
      return;
    }
    
    // Connection status change events
    this.events.on('ntrip:connecting', this.handleConnecting.bind(this));
    this.events.on('ntrip:connected', this.handleConnected.bind(this));
    this.events.on('ntrip:disconnected', this.handleDisconnected.bind(this));
    this.events.on('ntrip:error', this.handleError.bind(this));
    
    // Data statistics
    this.events.on('ntrip:rtcm', this.handleRtcmData.bind(this));
    
    // Handle position updates
    this.events.on('position', this.handlePosition.bind(this));
    
    // Update status periodically
    setInterval(() => {
      this.updateStats();
    }, 1000);
  }

  /**
   * Handle connecting event
   * @param {Object} data - Event data
   */
  handleConnecting(data) {
    this.isConnecting = true;
    this.isConnected = false;
    
    this.elements.statusIndicator.className = 'rtk-status-indicator connecting';
    this.elements.statusText.textContent = 'Connecting...';
    
    this.elements.connectButton.disabled = true;
    this.elements.disconnectButton.disabled = true;
    
    this.updateButtonVisibility();
  }

  /**
   * Handle connected event
   * @param {Object} data - Event data
   */
  handleConnected(data) {
    this.isConnecting = false;
    this.isConnected = true;
    
    this.elements.statusIndicator.className = 'rtk-status-indicator connected';
    
    // Check if GGA position is required
    if (data.requiresGga) {
      this.elements.statusText.textContent = `Connected to ${data.mountpoint} (${data.mode}) - GGA position required`;
      
      // Make sure GGA is enabled
      if (!this.elements.sendGga.checked) {
        this.elements.sendGga.checked = true;
        
        // Update the config
        if (this.gnss.ntripClient) {
          this.gnss.ntripClient.config.sendGga = true;
        }
        
        // Show info message
        console.log('GGA position sharing enabled automatically because the NTRIP caster requires it');
      }
      
      // Force a position update if we have one
      if (this.gnss.lastPosition) {
        setTimeout(() => {
          console.log('Sending initial GGA position to NTRIP caster');
          this.gnss.updateNtripPosition(this.gnss.lastPosition);
        }, 500);
      }
    } else {
      this.elements.statusText.textContent = `Connected to ${data.mountpoint} (${data.mode})`;
    }
    
    this.elements.connectButton.disabled = false;
    this.elements.disconnectButton.disabled = false;
    
    this.elements.correctionStats.style.display = 'block';
    
    this.updateButtonVisibility();
  }

  /**
   * Handle disconnected event
   * @param {Object} data - Event data
   */
  handleDisconnected(data) {
    this.isConnecting = false;
    this.isConnected = false;
    
    this.elements.statusIndicator.className = 'rtk-status-indicator disconnected';
    this.elements.statusText.textContent = `Disconnected: ${data.reason || 'Unknown reason'}`;
    
    this.elements.connectButton.disabled = false;
    this.elements.disconnectButton.disabled = true;
    
    this.updateButtonVisibility();
  }

  /**
   * Handle error event
   * @param {Object} data - Event data
   */
  handleError(data) {
    this.elements.statusIndicator.className = 'rtk-status-indicator error';
    this.elements.statusText.textContent = `Error: ${data.message}`;
    
    if (this.isConnecting) {
      this.isConnecting = false;
      this.elements.connectButton.disabled = false;
      this.elements.disconnectButton.disabled = true;
      
      this.updateButtonVisibility();
    }
  }

  /**
   * Handle RTCM data event
   * @param {Object} data - Event data
   */
  handleRtcmData(data) {
    if (!data.stats) return;
    
    const stats = data.stats;
    
    this.elements.messagesReceived.textContent = `Messages received: ${stats.messagesReceived}`;
    this.elements.bytesReceived.textContent = `Bytes received: ${this.formatBytes(stats.bytesReceived)}`;
    
    if (stats.correctionAge !== null) {
      this.elements.correctionAge.textContent = `Correction age: ${stats.correctionAge.toFixed(1)}s`;
    }
  }

  /**
   * Handle position update
   * @param {Object} position - Position data
   */
  handlePosition(position) {
    // Nothing to do for now, but we might want to update something in the UI later
  }

  /**
   * Format bytes to human-readable format
   * @param {number} bytes - Number of bytes
   * @returns {string} Formatted string
   */
  formatBytes(bytes) {
    if (bytes &lt; 1024) {
      return `${bytes} B`;
    } else if (bytes &lt; 1024 * 1024) {
      return `${(bytes / 1024).toFixed(1)} KB`;
    } else {
      return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
    }
  }

  /**
   * Update RTCM statistics
   */
  updateStats() {
    // Only update if connected
    if (!this.isConnected || !this.gnss.ntripClient) return;
    
    const stats = this.gnss.ntripClient.getRtcmStats();
    
    if (stats) {
      // Update correction age if available
      if (stats.correctionAge !== null) {
        this.elements.correctionAge.textContent = `Correction age: ${stats.correctionAge.toFixed(1)}s`;
        
        // Highlight old corrections
        if (stats.correctionAge > 10) {
          this.elements.correctionAge.style.color = '#f44336';
        } else if (stats.correctionAge > 5) {
          this.elements.correctionAge.style.color = '#ff9800';
        } else {
          this.elements.correctionAge.style.color = '#666';
        }
      }
    }
  }

  /**
   * Update form state based on enable toggle
   */
  updateFormState() {
    const enabled = this.elements.enableToggle.checked;
    
    // Enable/disable form elements
    const formElements = [
      this.elements.connectionMethod,
      this.elements.casterHost,
      this.elements.casterPort,
      this.elements.mountpoint,
      this.elements.username,
      this.elements.password,
      this.elements.sendGga,
      this.elements.ggaInterval,
      this.elements.autoReconnect
    ];
    
    formElements.forEach(element => {
      element.disabled = !enabled;
    });
    
    // Enable/disable buttons
    this.elements.saveButton.disabled = !enabled;
    this.elements.connectButton.disabled = !enabled || this.isConnected;
    
    // Update button visibility
    this.updateButtonVisibility();
  }

  /**
   * Update button visibility based on connection state
   */
  updateButtonVisibility() {
    // Show/hide connect/disconnect buttons
    if (this.isConnected) {
      this.elements.connectButton.style.display = 'none';
      this.elements.disconnectButton.style.display = 'block';
    } else {
      this.elements.connectButton.style.display = 'block';
      this.elements.disconnectButton.style.display = 'none';
    }
  }

  /**
   * Load saved configuration from settings
   */
  loadSavedConfig() {
    if (!this.settings || !this.settings.rtk || !this.elements) return;
    
    const rtkSettings = this.settings.rtk;
    
    // Safely set value if the element exists
    const safeSetValue = (elementKey, value) => {
      const element = this.elements[elementKey];
      if (element) {
        if (typeof element.checked !== 'undefined') {
          element.checked = Boolean(value);
        } else {
          element.value = value || '';
        }
      }
    };
    
    // Update UI elements
    safeSetValue('enableToggle', rtkSettings.enabled);
    safeSetValue('connectionMethod', rtkSettings.connectionMode || 'auto');
    safeSetValue('casterHost', rtkSettings.casterHost || '');
    safeSetValue('casterPort', rtkSettings.casterPort || 2101);
    safeSetValue('mountpoint', rtkSettings.mountpoint || '');
    safeSetValue('username', rtkSettings.username || '');
    // We don't restore password for security reasons
    safeSetValue('sendGga', rtkSettings.sendGga !== undefined ? rtkSettings.sendGga : true);
    safeSetValue('ggaInterval', rtkSettings.ggaUpdateInterval || 10);
    safeSetValue('autoReconnect', rtkSettings.autoReconnect !== undefined ? rtkSettings.autoReconnect : true);
    
    // Update form state
    this.updateFormState();
  }

  /**
   * Save configuration to settings
   */
  saveConfig() {
    if (!this.settings || !this.elements) return;
    
    // Safely get value from an element if it exists
    const safeGetValue = (elementKey, defaultValue = '') => {
      const element = this.elements[elementKey];
      if (!element) return defaultValue;
      
      if (typeof element.checked !== 'undefined') {
        return element.checked;
      } else {
        return element.value || defaultValue;
      }
    };
    
    // Get values from form
    const config = {
      enabled: safeGetValue('enableToggle', false),
      connectionMode: safeGetValue('connectionMethod', 'auto'),
      casterHost: safeGetValue('casterHost', ''),
      casterPort: parseInt(safeGetValue('casterPort', '2101')) || 2101,
      mountpoint: safeGetValue('mountpoint', ''),
      username: safeGetValue('username', ''),
      password: safeGetValue('password', ''),
      sendGga: safeGetValue('sendGga', true),
      ggaUpdateInterval: parseInt(safeGetValue('ggaInterval', '10')) || 10,
      autoReconnect: safeGetValue('autoReconnect', true)
    };
    
    // Save to settings
    if (this.settings) {
      this.settings.rtk = config;
      this.settings.save();
    }
    
    // Emit settings update event
    if (this.events) {
      this.events.emit('rtk:settings:update', config);
    }
    
    // If RTK is disabled but we're connected, disconnect
    if (!config.enabled &amp;&amp; this.isConnected) {
      this.disconnect();
    }
  }

  /**
   * Connect to NTRIP caster
   */
  async connect() {
    if (this.isConnected || this.isConnecting) return;
    
    // Get config from form
    const config = {
      connectionMode: this.elements.connectionMethod.value,
      casterHost: this.elements.casterHost.value,
      casterPort: parseInt(this.elements.casterPort.value) || 2101,
      mountpoint: this.elements.mountpoint.value,
      username: this.elements.username.value,
      password: this.elements.password.value,
      sendGga: this.elements.sendGga.checked,
      ggaUpdateInterval: parseInt(this.elements.ggaInterval.value) || 10,
      autoReconnect: this.elements.autoReconnect.checked
    };
    
    // Validate config
    if (!config.casterHost) {
      this.handleError({ message: 'Caster host is required' });
      return;
    }
    
    if (!config.mountpoint) {
      this.handleError({ message: 'Mountpoint is required' });
      return;
    }
    
    // Emit connect event
    if (this.events) {
      this.events.emit('rtk:connect', config);
    }
  }

  /**
   * Disconnect from NTRIP caster
   */
  disconnect() {
    if (!this.isConnected) return;
    
    // Emit disconnect event
    if (this.events) {
      this.events.emit('rtk:disconnect');
    }
  }
}

export default RtkSettings;</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BluetoothConnection.html">BluetoothConnection</a></div><div class="sidebar-section-children"><a href="ConnectionHandler.html">ConnectionHandler</a></div><div class="sidebar-section-children"><a href="ConnectionManager.html">ConnectionManager</a></div><div class="sidebar-section-children"><a href="DeviceSettings.html">DeviceSettings</a></div><div class="sidebar-section-children"><a href="EventEmitter.html">EventEmitter</a></div><div class="sidebar-section-children"><a href="GnssModule.html">GnssModule</a></div><div class="sidebar-section-children"><a href="NmeaParser.html">NmeaParser</a></div><div class="sidebar-section-children"><a href="NtripClient.html">NtripClient</a></div><div class="sidebar-section-children"><a href="RtkSettings.html">RtkSettings</a></div><div class="sidebar-section-children"><a href="RtkStatus.html">RtkStatus</a></div><div class="sidebar-section-children"><a href="Settings.html">Settings</a></div><div class="sidebar-section-children"><a href="SettingsPage.html">SettingsPage</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>