<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: ui/rtk-status.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BluetoothConnection.html">BluetoothConnection</a></div><div class="sidebar-section-children"><a href="ConnectionHandler.html">ConnectionHandler</a></div><div class="sidebar-section-children"><a href="ConnectionManager.html">ConnectionManager</a></div><div class="sidebar-section-children"><a href="DeviceSettings.html">DeviceSettings</a></div><div class="sidebar-section-children"><a href="EventEmitter.html">EventEmitter</a></div><div class="sidebar-section-children"><a href="GnssModule.html">GnssModule</a></div><div class="sidebar-section-children"><a href="NmeaParser.html">NmeaParser</a></div><div class="sidebar-section-children"><a href="NtripClient.html">NtripClient</a></div><div class="sidebar-section-children"><a href="RtkSettings.html">RtkSettings</a></div><div class="sidebar-section-children"><a href="RtkStatus.html">RtkStatus</a></div><div class="sidebar-section-children"><a href="Settings.html">Settings</a></div><div class="sidebar-section-children"><a href="SettingsPage.html">SettingsPage</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">ui_rtk-status.js</h1></header><article><pre class="prettyprint source lang-js"><code>/**
 * RTK Status UI Component
 * 
 * This component displays the current RTK fix status, including fix quality,
 * satellite information, and correction data status.
 */
export class RtkStatus {
  /**
   * Create an RTK status component
   * @param {Object} options - Configuration options
   * @param {EventEmitter} options.events - Event emitter for communication
   * @param {string} options.selector - CSS selector for the container element
   */
  constructor(options = {}) {
    this.events = options.events;
    
    // Find container element if selector provided
    if (options.selector) {
      this.container = document.querySelector(options.selector);
    }
    
    // If no container, don't initialize UI
    if (!this.container) {
      console.warn('RtkStatus: No container element found. UI will not be initialized.');
      return;
    }
    
    // Current status information
    this.fixQuality = 0;
    this.satellitesUsed = 0;
    this.rtkMode = 'none'; // 'none', 'float', 'fixed'
    this.correctionAge = null;
    this.messagesReceived = 0;
    this.ggaRequired = false;
    this.ntripConnected = false;
    
    // Add CSS for proper styling
    this.addStyles();
    
    // Initialize UI
    this.initializeUI();
    
    // Register event listeners
    this.registerEventListeners();
    
    // Update status immediately
    this.updateStatus();
  }

  /**
   * Add required CSS styles to the document
   */
  addStyles() {
    // Check if styles already exist
    if (document.getElementById('rtk-status-styles')) {
      return;
    }
    
    // Create style element
    const style = document.createElement('style');
    style.id = 'rtk-status-styles';
    style.textContent = `
      .rtk-status-container {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: #f7f7f7;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 12px;
        margin-bottom: 15px;
      }
      
      .rtk-status-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .rtk-indicator {
        display: flex;
        align-items: center;
        font-weight: 500;
      }
      
      .rtk-indicator-icon {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        margin-right: 8px;
      }
      
      .rtk-indicator-icon.no-fix { background-color: #9e9e9e; }
      .rtk-indicator-icon.autonomous { background-color: #ffcc00; }
      .rtk-indicator-icon.dgps { background-color: #ff9800; }
      .rtk-indicator-icon.rtk-float { background-color: #2196f3; }
      .rtk-indicator-icon.rtk-fixed { background-color: #4caf50; }
      
      .rtk-status-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-top: 10px;
        font-size: 13px;
      }
      
      .rtk-status-detail {
        display: flex;
        align-items: center;
      }
      
      .rtk-status-detail-icon {
        width: 12px;
        height: 12px;
        margin-right: 6px;
        opacity: 0.7;
      }
      
      .rtk-status-detail-label {
        color: #666;
        margin-right: 5px;
      }
      
      .rtk-status-detail-value {
        font-weight: 500;
      }
      
      .rtk-status-correction-age {
        color: #666;
      }
      
      .rtk-status-correction-age.stale {
        color: #ff9800;
      }
      
      .rtk-status-correction-age.old {
        color: #f44336;
      }
      
      .rtk-satellite-indicator {
        margin-top: 5px;
        height: 4px;
        display: flex;
        gap: 2px;
      }
      
      .rtk-satellite-bar {
        flex: 1;
        background-color: #e0e0e0;
        border-radius: 2px;
      }
      
      .rtk-satellite-bar.used {
        background-color: #4caf50;
      }
      
      @media (max-width: 480px) {
        .rtk-status-details {
          grid-template-columns: 1fr;
        }
      }
    `;
    
    // Add style to document
    document.head.appendChild(style);
  }

  /**
   * Initialize the UI elements
   */
  initializeUI() {
    if (!this.container) return;
    
    // Clear container
    this.container.innerHTML = '';
    
    // Create main container
    const statusContainer = document.createElement('div');
    statusContainer.className = 'rtk-status-container';
    
    // Create header with main indicator
    const header = document.createElement('div');
    header.className = 'rtk-status-header';
    
    // Create status indicator
    const indicator = document.createElement('div');
    indicator.className = 'rtk-indicator';
    
    const indicatorIcon = document.createElement('div');
    indicatorIcon.className = 'rtk-indicator-icon no-fix';
    
    const indicatorText = document.createElement('div');
    indicatorText.textContent = 'No Fix';
    
    indicator.appendChild(indicatorIcon);
    indicator.appendChild(indicatorText);
    
    header.appendChild(indicator);
    statusContainer.appendChild(header);
    
    // Create satellite indicator
    const satelliteIndicator = document.createElement('div');
    satelliteIndicator.className = 'rtk-satellite-indicator';
    
    // Create bars for satellites (up to 20)
    for (let i = 0; i &lt; 20; i++) {
      const bar = document.createElement('div');
      bar.className = 'rtk-satellite-bar';
      satelliteIndicator.appendChild(bar);
    }
    
    statusContainer.appendChild(satelliteIndicator);
    
    // Create status details
    const details = document.createElement('div');
    details.className = 'rtk-status-details';
    
    // Satellites
    const satellitesDetail = document.createElement('div');
    satellitesDetail.className = 'rtk-status-detail';
    
    const satellitesIcon = document.createElement('div');
    satellitesIcon.className = 'rtk-status-detail-icon';
    satellitesIcon.innerHTML = `&lt;svg viewBox="0 0 24 24" width="12" height="12">&lt;path fill="currentColor" d="M5,18L8.5,13.5L11,16.5L14.5,12L19,18H5M5,12V10A5,5 0 0,1 10,5H12V3L16,6L12,9V7H10A3,3 0 0,0 7,10V12H5Z" />&lt;/svg>`;
    
    const satellitesLabel = document.createElement('div');
    satellitesLabel.className = 'rtk-status-detail-label';
    satellitesLabel.textContent = 'Satellites:';
    
    const satellitesValue = document.createElement('div');
    satellitesValue.className = 'rtk-status-detail-value';
    satellitesValue.textContent = '0';
    
    satellitesDetail.appendChild(satellitesIcon);
    satellitesDetail.appendChild(satellitesLabel);
    satellitesDetail.appendChild(satellitesValue);
    
    details.appendChild(satellitesDetail);
    
    // Mode
    const modeDetail = document.createElement('div');
    modeDetail.className = 'rtk-status-detail';
    
    const modeIcon = document.createElement('div');
    modeIcon.className = 'rtk-status-detail-icon';
    modeIcon.innerHTML = `&lt;svg viewBox="0 0 24 24" width="12" height="12">&lt;path fill="currentColor" d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z" />&lt;/svg>`;
    
    const modeLabel = document.createElement('div');
    modeLabel.className = 'rtk-status-detail-label';
    modeLabel.textContent = 'Mode:';
    
    const modeValue = document.createElement('div');
    modeValue.className = 'rtk-status-detail-value';
    modeValue.textContent = 'None';
    
    modeDetail.appendChild(modeIcon);
    modeDetail.appendChild(modeLabel);
    modeDetail.appendChild(modeValue);
    
    details.appendChild(modeDetail);
    
    // Correction age
    const correctionDetail = document.createElement('div');
    correctionDetail.className = 'rtk-status-detail';
    
    const correctionIcon = document.createElement('div');
    correctionIcon.className = 'rtk-status-detail-icon';
    correctionIcon.innerHTML = `&lt;svg viewBox="0 0 24 24" width="12" height="12">&lt;path fill="currentColor" d="M19,22H5V20H19V22M17,10C15.58,10 14.26,10.77 13.55,12H13V7H16V5H13V2H11V5H8V7H11V12H10.45C9.74,10.77 8.42,10 7,10A4,4 0 0,0 3,14A4,4 0 0,0 7,18C8.42,18 9.74,17.23 10.45,16H13.55C14.26,17.23 15.58,18 17,18A4,4 0 0,0 21,14A4,4 0 0,0 17,10M7,16A2,2 0 0,1 5,14A2,2 0 0,1 7,12A2,2 0 0,1 9,14A2,2 0 0,1 7,16M17,16A2,2 0 0,1 15,14A2,2 0 0,1 17,12A2,2 0 0,1 19,14A2,2 0 0,1 17,16Z" />&lt;/svg>`;
    
    const correctionLabel = document.createElement('div');
    correctionLabel.className = 'rtk-status-detail-label';
    correctionLabel.textContent = 'Correction:';
    
    const correctionValue = document.createElement('div');
    correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age';
    correctionValue.textContent = 'N/A';
    
    correctionDetail.appendChild(correctionIcon);
    correctionDetail.appendChild(correctionLabel);
    correctionDetail.appendChild(correctionValue);
    
    details.appendChild(correctionDetail);
    
    // Messages
    const messagesDetail = document.createElement('div');
    messagesDetail.className = 'rtk-status-detail';
    
    const messagesIcon = document.createElement('div');
    messagesIcon.className = 'rtk-status-detail-icon';
    messagesIcon.innerHTML = `&lt;svg viewBox="0 0 24 24" width="12" height="12">&lt;path fill="currentColor" d="M17,12V3A1,1 0 0,0 16,2H3A1,1 0 0,0 2,3V17L6,13H16A1,1 0 0,0 17,12M21,6H19V15H6V17A1,1 0 0,0 7,18H18L22,22V7A1,1 0 0,0 21,6Z" />&lt;/svg>`;
    
    const messagesLabel = document.createElement('div');
    messagesLabel.className = 'rtk-status-detail-label';
    messagesLabel.textContent = 'Messages:';
    
    const messagesValue = document.createElement('div');
    messagesValue.className = 'rtk-status-detail-value';
    messagesValue.textContent = '0';
    
    messagesDetail.appendChild(messagesIcon);
    messagesDetail.appendChild(messagesLabel);
    messagesDetail.appendChild(messagesValue);
    
    details.appendChild(messagesDetail);
    
    statusContainer.appendChild(details);
    
    // Add to container
    this.container.appendChild(statusContainer);
    
    // Store references to elements
    this.elements = {
      indicatorIcon,
      indicatorText,
      satelliteIndicator,
      satellitesValue,
      modeValue,
      correctionValue,
      messagesValue
    };
  }

  /**
   * Register event listeners for GNSS and NTRIP events
   */
  registerEventListeners() {
    if (!this.events) {
      console.warn('RtkStatus: No events emitter provided. Status will not update.');
      return;
    }
    
    // GNSS position events
    this.events.on('position', this.handlePosition.bind(this));
    
    // NTRIP correction events
    this.events.on('ntrip:rtcm', this.handleRtcmData.bind(this));
    
    // NTRIP status events
    this.events.on('ntrip:connected', this.handleNtripConnected.bind(this));
    this.events.on('ntrip:disconnected', this.handleNtripDisconnected.bind(this));
    
    // Update status periodically
    setInterval(() => {
      this.updateStatus();
    }, 1000);
  }

  /**
   * Handle position update event
   * @param {Object} position - Position data
   */
  handlePosition(position) {
    // Update satellites used
    if (position.satellites !== undefined) {
      this.satellitesUsed = position.satellites;
    }
    
    // Update fix quality
    if (position.quality !== undefined) {
      this.fixQuality = position.quality;
    }
    
    // Update UI
    this.updateStatus();
  }

  /**
   * Handle RTCM data event
   * @param {Object} data - RTCM data and stats
   */
  handleRtcmData(data) {
    if (!data.stats) return;
    
    // Update message count
    this.messagesReceived = data.stats.messagesReceived;
    
    // Update correction age
    if (data.stats.correctionAge !== undefined) {
      this.correctionAge = data.stats.correctionAge;
    }
    
    // Update UI
    this.updateStatus();
  }

  /**
   * Handle NTRIP connected event
   * @param {Object} data - Connection data
   */
  handleNtripConnected(data) {
    // Reset stats
    this.messagesReceived = 0;
    this.correctionAge = null;
    this.ntripConnected = true;
    
    // Check if GGA is required
    if (data.requiresGga) {
      this.ggaRequired = true;
      
      // If we have a position, make sure it's sent to NTRIP
      if (this.gnss.lastPosition &amp;&amp; this.gnss.ntripClient) {
        setTimeout(() => {
          this.gnss.updateNtripPosition(this.gnss.lastPosition);
        }, 500);
      }
    }
    
    // Update UI
    this.updateStatus();
  }

  /**
   * Handle NTRIP disconnected event
   * @param {Object} data - Disconnection data
   */
  handleNtripDisconnected(data) {
    // Clear correction age
    this.correctionAge = null;
    this.ntripConnected = false;
    this.ggaRequired = false;
    
    // Update UI
    this.updateStatus();
  }

  /**
   * Update the status display
   */
  updateStatus() {
    if (!this.elements) return;
    
    // Update fix quality indicator
    this.updateFixQualityIndicator();
    
    // Update satellite count
    this.elements.satellitesValue.textContent = this.satellitesUsed.toString();
    
    // Update satellite bars
    this.updateSatelliteBars();
    
    // Update RTK mode
    this.elements.modeValue.textContent = this.getRtkModeName();
    
    // Update correction age
    if (this.correctionAge !== null) {
      this.elements.correctionValue.textContent = `${this.correctionAge.toFixed(1)}s`;
      
      // Highlight old corrections
      if (this.correctionAge > 10) {
        this.elements.correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age old';
      } else if (this.correctionAge > 5) {
        this.elements.correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age stale';
      } else {
        this.elements.correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age';
      }
    } else if (this.ntripConnected &amp;&amp; this.ggaRequired) {
      // Special message if connected to NTRIP but no corrections received and GGA is required
      this.elements.correctionValue.textContent = 'Waiting for GGA';
      this.elements.correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age stale';
    } else if (this.ntripConnected) {
      this.elements.correctionValue.textContent = 'Waiting for data';
      this.elements.correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age';
    } else {
      this.elements.correctionValue.textContent = 'N/A';
      this.elements.correctionValue.className = 'rtk-status-detail-value rtk-status-correction-age';
    }
    
    // Update message count
    this.elements.messagesValue.textContent = this.messagesReceived.toString();
  }

  /**
   * Update the fix quality indicator
   */
  updateFixQualityIndicator() {
    let indicatorClass = 'no-fix';
    let indicatorText = 'No Fix';
    
    switch (this.fixQuality) {
      case 1:
        indicatorClass = 'autonomous';
        indicatorText = 'Autonomous Fix';
        this.rtkMode = 'none';
        break;
      case 2:
        indicatorClass = 'dgps';
        indicatorText = 'DGPS';
        this.rtkMode = 'none';
        break;
      case 4:
        indicatorClass = 'rtk-fixed';
        indicatorText = 'RTK Fixed';
        this.rtkMode = 'fixed';
        break;
      case 5:
        indicatorClass = 'rtk-float';
        indicatorText = 'RTK Float';
        this.rtkMode = 'float';
        break;
      default:
        indicatorClass = 'no-fix';
        indicatorText = 'No Fix';
        this.rtkMode = 'none';
        break;
    }
    
    this.elements.indicatorIcon.className = `rtk-indicator-icon ${indicatorClass}`;
    this.elements.indicatorText.textContent = indicatorText;
  }

  /**
   * Update the satellite bars
   */
  updateSatelliteBars() {
    // Get all satellite bars
    const bars = this.elements.satelliteIndicator.children;
    
    // Update up to the available satellites
    for (let i = 0; i &lt; bars.length; i++) {
      if (i &lt; this.satellitesUsed) {
        bars[i].className = 'rtk-satellite-bar used';
      } else {
        bars[i].className = 'rtk-satellite-bar';
      }
    }
  }

  /**
   * Get RTK mode name
   * @returns {string} RTK mode name
   */
  getRtkModeName() {
    switch (this.rtkMode) {
      case 'fixed':
        return 'RTK Fixed';
      case 'float':
        return 'RTK Float';
      default:
        return 'Standalone';
    }
  }
}

export default RtkStatus;</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BluetoothConnection.html">BluetoothConnection</a></div><div class="sidebar-section-children"><a href="ConnectionHandler.html">ConnectionHandler</a></div><div class="sidebar-section-children"><a href="ConnectionManager.html">ConnectionManager</a></div><div class="sidebar-section-children"><a href="DeviceSettings.html">DeviceSettings</a></div><div class="sidebar-section-children"><a href="EventEmitter.html">EventEmitter</a></div><div class="sidebar-section-children"><a href="GnssModule.html">GnssModule</a></div><div class="sidebar-section-children"><a href="NmeaParser.html">NmeaParser</a></div><div class="sidebar-section-children"><a href="NtripClient.html">NtripClient</a></div><div class="sidebar-section-children"><a href="RtkSettings.html">RtkSettings</a></div><div class="sidebar-section-children"><a href="RtkStatus.html">RtkStatus</a></div><div class="sidebar-section-children"><a href="Settings.html">Settings</a></div><div class="sidebar-section-children"><a href="SettingsPage.html">SettingsPage</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>